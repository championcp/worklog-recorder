# Business Rules Documentation
## Sprint 2: WBS Task Management System

### Document Information
- **Version**: 1.0
- **Date**: 2025-08-04
- **Status**: Approved
- **Product Owner**: Product Team
- **Business Analyst**: [Name]

---

## Overview

This document defines the comprehensive business rules governing the WBS (Work Breakdown Structure) task management system in Sprint 2. These rules ensure data integrity, enforce business logic, and provide consistent behavior across all system interactions.

---

## Core Business Rules

### BR001: Task Hierarchy Rules

#### BR001.1: Maximum Hierarchy Depth
- **Rule**: The system SHALL support a maximum of 3 levels in the task hierarchy
- **Rationale**: Prevents over-complexity while providing sufficient granularity for most project management needs
- **Implementation**: 
  - Level 1: Root tasks (top-level project components)
  - Level 2: Sub-tasks (detailed breakdowns of root tasks)
  - Level 3: Detail tasks (specific actionable items)
- **Validation**: System MUST prevent creation of Level 4 tasks
- **Error Message**: "Maximum task hierarchy depth is 3 levels"
- **Impact**: UI controls disabled, API validation enforced

#### BR001.2: Parent-Child Relationship Integrity
- **Rule**: Tasks MUST maintain valid parent-child relationships at all times
- **Rationale**: Ensures structural integrity of the task hierarchy
- **Implementation**:
  - Child tasks MUST reference valid, non-deleted parent tasks
  - Parent tasks CAN exist without children
  - Orphaned tasks are NOT allowed
- **Validation**: Foreign key constraints and application-level validation
- **Exception Handling**: System MUST prevent operations that would create orphaned tasks

#### BR001.3: Task Deletion Constraints
- **Rule**: Parent tasks CANNOT be deleted while they have active children
- **Rationale**: Prevents data integrity issues and maintains hierarchical structure
- **Implementation**: 
  - Before deletion, system MUST check for active child tasks
  - Users MUST delete all children before deleting parent
  - Soft deletion is used to maintain audit trail
- **Error Message**: "Cannot delete task with active children. Please delete all child tasks first."
- **Workaround**: Users must delete from leaves upward in the hierarchy

#### BR001.4: Task Level Assignment
- **Rule**: Task levels are automatically assigned based on hierarchy position and CANNOT be manually modified
- **Rationale**: Ensures consistent hierarchy structure and prevents user errors
- **Implementation**:
  - Root tasks automatically assigned Level 1
  - Child tasks assigned parent level + 1
  - Level cannot be changed after task creation
- **Validation**: Level field is read-only in all edit operations

---

### BR002: WBS Code Generation Rules

#### BR002.1: Automatic Code Generation
- **Rule**: WBS codes are automatically generated by the system and CANNOT be manually edited
- **Rationale**: Ensures consistent numbering scheme and prevents duplicate or invalid codes
- **Implementation**:
  - Root tasks: Sequential numbers (1, 2, 3, ...)
  - Sub-tasks: Parent code + dot + sequence (1.1, 1.2, 2.1, ...)
  - Detail tasks: Grandparent.Parent.Sequence (1.1.1, 1.2.3, ...)
- **Validation**: WBS code field is system-generated and read-only
- **Exception**: Codes may be regenerated if task hierarchy changes

#### BR002.2: Code Uniqueness
- **Rule**: WBS codes MUST be unique within a project scope
- **Rationale**: Provides unambiguous task identification
- **Implementation**: Database unique constraint on (project_id, wbs_code)
- **Validation**: System prevents creation of duplicate codes
- **Error Handling**: If uniqueness violation occurs, system regenerates sequence

#### BR002.3: Code Stability
- **Rule**: WBS codes SHOULD remain stable throughout task lifecycle
- **Rationale**: Supports external references and reporting consistency
- **Implementation**: Codes only change when task hierarchy is restructured
- **Exception**: Code regeneration may occur during batch operations or hierarchy cleanup

#### BR002.4: Code Format Standards
- **Rule**: WBS codes MUST follow the format: Level1[.Level2[.Level3]]
- **Rationale**: Provides human-readable hierarchical identification
- **Implementation**:
  - Numeric sequences only (no alphabetic characters)
  - Dot separator between levels
  - No leading zeros (use 1, not 01)
- **Validation**: Regex pattern validation on code format

---

### BR003: Task Status Management Rules

#### BR003.1: Status Values
- **Rule**: Task status MUST be one of: not_started, in_progress, completed, paused, cancelled
- **Rationale**: Provides standardized status vocabulary for consistent reporting
- **Implementation**: Database enum constraint and UI dropdown validation
- **Default**: New tasks default to 'not_started' status

#### BR003.2: Status-Progress Relationship
- **Rule**: When task status changes to 'completed', progress MUST automatically update to 100%
- **Rationale**: Ensures consistency between status and progress indicators
- **Implementation**: Database trigger or application logic on status update
- **Override**: Progress can be manually set to 100% without changing status to completed

#### BR003.3: Completion Timestamp
- **Rule**: When task status changes to 'completed', completion timestamp MUST be automatically set
- **Rationale**: Provides audit trail and enables completion date reporting
- **Implementation**: Set completed_at field to current timestamp on status change
- **Reset Rule**: If status changes from 'completed' to any other status, completed_at MUST be cleared

#### BR003.4: Status Transition Validation
- **Rule**: All status transitions are allowed (no workflow constraints)
- **Rationale**: Provides flexibility for project management needs
- **Implementation**: No validation restrictions on status changes
- **Audit**: All status changes are logged for audit purposes

---

### BR004: Task Priority Rules

#### BR004.1: Priority Values
- **Rule**: Task priority MUST be one of: low, medium, high, urgent
- **Rationale**: Provides standardized priority levels for task organization
- **Implementation**: Database enum constraint and UI dropdown validation
- **Default**: New tasks default to 'medium' priority

#### BR004.2: Priority Independence
- **Rule**: Task priority is independent of hierarchy level and can be set for any task
- **Rationale**: Allows for flexible prioritization based on business needs
- **Implementation**: No validation rules linking priority to other task attributes
- **Exception**: Priority does not affect system behavior, only display and reporting

#### BR004.3: Priority Visual Indicators
- **Rule**: Each priority level MUST have distinct visual representation
- **Rationale**: Enables quick visual assessment of task priorities
- **Implementation**:
  - Low: Gray color indicator
  - Medium: Blue color indicator
  - High: Orange color indicator
  - Urgent: Red color indicator
- **Accessibility**: Color indicators MUST be supplemented with text labels

---

### BR005: Progress Tracking Rules

#### BR005.1: Progress Range
- **Rule**: Progress percentage MUST be between 0 and 100 (inclusive)
- **Rationale**: Provides bounded progress measurement
- **Implementation**: Database check constraint and UI validation
- **Error Message**: "Progress must be between 0% and 100%"

#### BR005.2: Progress Independence
- **Rule**: Progress percentage can be set independently of task status
- **Rationale**: Allows for nuanced progress tracking beyond simple status
- **Implementation**: Progress and status are separate fields with independent validation
- **Exception**: Automatic progress update when status changes to 'completed'

#### BR005.3: Progress Precision
- **Rule**: Progress percentage is stored and displayed as integer values (0-100)
- **Rationale**: Simplifies UI interaction and prevents false precision
- **Implementation**: Integer field in database, slider control in UI
- **Rounding**: Any decimal inputs are rounded to nearest integer

---

### BR006: Time Management Rules

#### BR006.1: Date Validation
- **Rule**: If both start_date and end_date are provided, end_date MUST be greater than or equal to start_date
- **Rationale**: Prevents logical inconsistencies in task scheduling
- **Implementation**: Application-level validation on date fields
- **Error Message**: "End date cannot be before start date"

#### BR006.2: Date Optionality
- **Rule**: Both start_date and end_date are optional fields
- **Rationale**: Accommodates various project management styles and task types
- **Implementation**: Nullable date fields in database
- **Default**: No default dates are set for new tasks

#### BR006.3: Estimated Hours Validation
- **Rule**: Estimated hours, if provided, MUST be a positive number not exceeding 999
- **Rationale**: Prevents negative values and unrealistic estimates
- **Implementation**: Database check constraint and UI validation
- **Precision**: Decimal values allowed with 0.5 hour increments
- **Error Message**: "Estimated hours must be positive and not exceed 999"

#### BR006.4: Actual Hours Tracking
- **Rule**: Actual hours are automatically calculated from time logging activities
- **Rationale**: Ensures accuracy and eliminates manual entry errors
- **Implementation**: Calculated field based on time log entries
- **Override**: Actual hours cannot be manually edited

---

### BR007: Task Name and Description Rules

#### BR007.1: Name Requirements
- **Rule**: Task name is REQUIRED and MUST not be empty or contain only whitespace
- **Rationale**: Ensures all tasks have meaningful identification
- **Implementation**: NOT NULL constraint and trim validation
- **Length Limit**: Task names MUST not exceed 255 characters
- **Error Message**: "Task name is required and cannot be empty"

#### BR007.2: Name Uniqueness
- **Rule**: Task names SHOULD be unique within a project but uniqueness is NOT enforced
- **Rationale**: Encourages clear naming while allowing flexibility
- **Implementation**: No database constraint, UI warning for duplicates
- **Warning Message**: "A task with this name already exists in the project"

#### BR007.3: Description Optionality
- **Rule**: Task description is optional and has no length restrictions
- **Rationale**: Accommodates various levels of detail based on task complexity
- **Implementation**: Nullable text field with no length constraints
- **Display**: Long descriptions are truncated in tree view with tooltip expansion

---

### BR008: Project Integration Rules

#### BR008.1: Project Association
- **Rule**: Every WBS task MUST be associated with exactly one project
- **Rationale**: Provides clear scope and access control boundaries
- **Implementation**: Foreign key constraint to projects table
- **Validation**: project_id is required for all task operations

#### BR008.2: Project Access Control
- **Rule**: Users can only access WBS tasks for projects they have permission to view
- **Rationale**: Maintains project-level security boundaries
- **Implementation**: Join projects table in all task queries with user access validation
- **Error Message**: "Project not found or access denied"

#### BR008.3: Project Deletion Cascade
- **Rule**: When a project is deleted, all associated WBS tasks MUST be soft-deleted
- **Rationale**: Maintains data integrity while preserving audit trail
- **Implementation**: Cascade update on project deletion to mark tasks as deleted
- **Recovery**: Soft-deleted tasks can be recovered if project is restored

---

### BR009: Level Type Classification Rules

#### BR009.1: Level Type Values
- **Rule**: Level type MUST be one of: yearly, half_yearly, quarterly, monthly, weekly, daily
- **Rationale**: Provides temporal classification for task planning
- **Implementation**: Database enum constraint and UI dropdown validation
- **Default**: Level type defaults based on task hierarchy and parent type

#### BR009.2: Level Type Hierarchy
- **Rule**: Child task level types SHOULD represent smaller time periods than parent tasks
- **Rationale**: Maintains logical temporal hierarchy
- **Implementation**: UI suggestions but no enforced validation
- **Flexibility**: Users can override suggested level types based on project needs

#### BR009.3: Level Type Independence
- **Rule**: Level type does not affect system behavior, only categorization and reporting
- **Rationale**: Provides metadata without constraining functionality
- **Implementation**: Field used for display and reporting purposes only

---

### BR010: Data Integrity and Audit Rules

#### BR010.1: Soft Deletion
- **Rule**: Task deletion is always "soft delete" - tasks are marked as deleted but not physically removed
- **Rationale**: Maintains audit trail and enables data recovery
- **Implementation**: is_deleted boolean field, exclude deleted records from normal queries
- **Cleanup**: Archived tasks may be physically deleted after retention period

#### BR010.2: Sync Versioning
- **Rule**: All task modifications MUST increment the sync_version counter
- **Rationale**: Supports synchronization and conflict detection in distributed scenarios
- **Implementation**: Increment sync_version on every UPDATE operation
- **Initial Value**: New tasks start with sync_version = 1

#### BR010.3: Timestamp Maintenance
- **Rule**: created_at and updated_at timestamps MUST be automatically maintained
- **Rationale**: Provides audit trail and change tracking
- **Implementation**: 
  - created_at set on INSERT operations
  - updated_at set on INSERT and UPDATE operations
- **Format**: ISO 8601 format timestamps (YYYY-MM-DDTHH:MM:SS.sssZ)

#### BR010.4: Last Sync Tracking
- **Rule**: last_sync_at timestamp tracks last synchronization time for distributed scenarios
- **Rationale**: Supports future synchronization features
- **Implementation**: Optional field updated during sync operations
- **Default**: NULL for tasks created locally

---

### BR011: UI and UX Rules

#### BR011.1: Tree Expansion State
- **Rule**: Task tree nodes default to collapsed state and expansion state is NOT persisted across sessions
- **Rationale**: Provides clean initial view and prevents information overload
- **Implementation**: Client-side state management, reset on page reload
- **Exception**: Deep-linked tasks may auto-expand parent nodes

#### BR011.2: Bulk Operations
- **Rule**: "Expand All" and "Collapse All" operations apply to all nodes in the current project
- **Rationale**: Provides quick navigation options for large task trees
- **Implementation**: Client-side tree state manipulation
- **Performance**: Operations should complete within 200ms for trees up to 500 tasks

#### BR011.3: Visual Hierarchy
- **Rule**: Task hierarchy MUST be visually distinguishable through indentation and visual cues
- **Rationale**: Ensures clear understanding of task relationships
- **Implementation**: CSS indentation (24px per level) and connecting lines
- **Accessibility**: Hierarchy relationships announced to screen readers

---

### BR012: Performance and Scalability Rules

#### BR012.1: Task Count Limits
- **Rule**: Maximum limits are enforced to maintain system performance
- **Implementation**:
  - Maximum 100 root tasks per project
  - Maximum 50 sub-tasks per root task
  - Maximum 20 detail tasks per sub-task
- **Rationale**: Prevents performance degradation while supporting typical use cases
- **Error Message**: "Maximum number of tasks exceeded for this level"

#### BR012.2: Query Performance
- **Rule**: Task tree queries MUST complete within 2 seconds for projects with up to 500 tasks
- **Rationale**: Ensures acceptable user experience
- **Implementation**: Optimized database queries with appropriate indexing
- **Monitoring**: Performance metrics tracked and alerts configured

#### BR012.3: Memory Management
- **Rule**: Client-side task tree representation MUST not exceed reasonable memory limits
- **Rationale**: Prevents browser performance issues
- **Implementation**: Efficient data structures and cleanup on component unmount
- **Threshold**: Maximum 10MB memory usage for task tree components

---

## Business Rule Validation Matrix

| Rule Category | Database Level | Application Level | UI Level | Error Handling |
|---------------|----------------|-------------------|----------|----------------|
| Hierarchy Depth | ✓ | ✓ | ✓ | Graceful |
| WBS Codes | ✓ | ✓ | ✓ | Auto-recovery |
| Status Values | ✓ | ✓ | ✓ | Graceful |
| Progress Range | ✓ | ✓ | ✓ | Graceful |
| Date Validation | ✗ | ✓ | ✓ | Graceful |
| Project Access | ✓ | ✓ | ✓ | Security |
| Name Requirements | ✓ | ✓ | ✓ | Graceful |
| Task Limits | ✗ | ✓ | ✓ | Graceful |

---

## Exception Handling

### Critical Violations
- **Data Integrity**: Database constraint violations result in transaction rollback
- **Security**: Access control violations result in immediate request termination
- **Hierarchy**: Hierarchy violations prevent operation completion with clear error messages

### Non-Critical Violations
- **Validation Warnings**: UI warnings for non-critical issues (e.g., duplicate names)
- **Performance**: Graceful degradation when performance thresholds are exceeded
- **UX Guidelines**: Soft enforcement of UX rules with user override options

---

## Compliance and Monitoring

### Rule Enforcement Monitoring
- **Database Metrics**: Monitor constraint violation rates
- **Application Metrics**: Track validation failure rates by rule category
- **User Experience**: Monitor error message frequency and user resolution rates

### Business Rule Evolution
- **Change Process**: All business rule changes require stakeholder approval
- **Impact Assessment**: Evaluate impact on existing data and user workflows
- **Migration Strategy**: Plan for rule changes that affect existing tasks

---

## Appendix: Rule Implementation Examples

### Example 1: Task Creation Validation
```
User attempts to create Level 4 task:
1. UI checks parent level (Level 3)
2. UI disables "Add Child" button with tooltip
3. If bypassed, API validates hierarchy depth
4. Returns error: "Maximum task hierarchy depth is 3 levels"
5. UI displays error message
6. Task creation is prevented
```

### Example 2: Status Change Automation
```
User changes task status to 'completed':
1. UI updates status field
2. Application logic triggers progress update
3. Progress automatically set to 100%
4. completed_at timestamp set to current time
5. sync_version incremented
6. Database transaction commits all changes
7. UI reflects all automated updates
```

### Example 3: Task Deletion Validation
```
User attempts to delete parent task:
1. Application checks for active children
2. Query: SELECT COUNT(*) FROM tasks WHERE parent_id = ? AND is_deleted = 0
3. If count > 0, return error
4. UI displays: "Cannot delete task with active children"
5. User must delete children first
6. Once no children exist, deletion proceeds with soft delete
```

---

**Document Status**: Approved for Implementation  
**Implementation Priority**: Must implement all BR001-BR008, Should implement BR009-BR012  
**Review Schedule**: Bi-weekly during Sprint 2, monthly post-implementation